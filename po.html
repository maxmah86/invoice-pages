<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Create Purchase Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 16px;
}

h1 {
  margin: 0 0 6px;
}

.subtitle {
  font-size: 14px;
  color: #555;
  margin-bottom: 16px;
}

.card {
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 14px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

label {
  display: block;
  margin-top: 12px;
  margin-bottom: 4px;
  font-size: 14px;
  font-weight: bold;
}

input, textarea {
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
}

button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

.btn-primary {
  background: #2c3e50;
  color: #fff;
}

.btn-secondary {
  background: #7f8c8d;
  color: #fff;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>Create Purchase Order</h1>
<div class="subtitle">MMAC Construction</div>

<!-- ===== BASIC INFO ===== -->
<div class="card">
  <label>Issued By</label>
  <input id="issued_by" placeholder="MMAC Construction">

  <label>Supplier</label>
  <input id="supplier_name" placeholder="Supplier name">
</div>

<!-- ===== DELIVERY INFO ===== -->
<div class="card">
  <label>Delivery Address</label>
  <textarea id="delivery_address" rows="3"
    placeholder="Full delivery address"></textarea>

  <label>Delivery Date</label>
  <input type="date" id="delivery_date">

  <label>Delivery Time</label>
  <input type="time" id="delivery_time">
</div>

<!-- ===== NOTES ===== -->
<div class="card">
  <label>Notes</label>
  <textarea id="notes" rows="3">
Please supply the above items/services as per stated quantities and prices.
  </textarea>
</div>

<!-- ===== ACTION ===== -->
<div class="card">
  <button class="btn-primary" onclick="submitPO()">Create PO</button>
  <button class="btn-secondary" onclick="history.back()">Cancel</button>
</div>

<script>
/* ===== LOGIN CHECK ===== */
fetch("/api/auth-check", { credentials: "include" })
  .then(r => r.json())
  .then(d => {
    if (!d.loggedIn) location.replace("/login.html");
  })
  .catch(() => location.replace("/login.html"));

/* ===== SUBMIT PO ===== */
async function submitPO() {
  const payload = {
    issued_by: issued_by.value,
    supplier_name: supplier_name.value,
    delivery_address: delivery_address.value,
    delivery_date: delivery_date.value,
    delivery_time: delivery_time.value,
    notes: notes.value
  };

  if (!payload.supplier_name) {
    alert("Supplier is required");
    return;
  }

  const res = await fetch("/api/po-create", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    credentials: "include",
    body: JSON.stringify(payload)
  });

  const data = await res.json();

  if (data.success) {
    alert("PO created");
    location.href = "/pos.html";
  } else {
    alert(data.error || "Failed to create PO");
  }
}
</script>

</body>
</html>
