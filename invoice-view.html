<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Invoice</title>

<style>
  body {
    font-family: Arial, sans-serif;
    color: #000;
    margin: 20px;
  }

  .header {
    display: flex;
    justify-content: space-between;
  }

  .company h2 {
    margin: 0;
    font-size: 20px;
  }

  .company p {
    margin: 2px 0;
    font-size: 13px;
  }

  .invoice-title {
    text-align: right;
  }

  .invoice-title h1 {
    margin: 0;
    font-size: 28px;
  }

  .meta {
    font-size: 13px;
    margin-top: 10px;
  }

  hr {
    margin: 15px 0;
  }

  .to {
    font-size: 14px;
    margin-bottom: 15px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  table th, table td {
    border: 1px solid #000;
    padding: 6px;
  }

  table th {
    background: #f0f0f0;
    text-align: center;
  }

  .right { text-align: right; }
  .center { text-align: center; }

  .total {
    margin-top: 10px;
    text-align: right;
    font-size: 15px;
    font-weight: bold;
  }

  .terms {
    margin-top: 20px;
    font-size: 13px;
  }

  .bank {
    margin-top: 10px;
    font-size: 13px;
  }

  button {
    margin-bottom: 15px;
  }

  @media print {
    button { display: none; }
    body { margin: 0; }
    @page {
      size: A4;
      margin: 15mm;
    }
  }
</style>
</head>

<body>

<button onclick="window.print()">Print / Save PDF</button>

<!-- HEADER -->
<div class="header">
  <div class="company">
    <h2>MMAC CONSTRUCTION</h2>
    <p>201903139488 (002972725-A)</p>
    <p>52, Jalan Mahogani SD 1/3</p>
    <p>Sri Damansara, 52200 Kuala Lumpur</p>
    <p>Tel : 016-444-2128</p>
  </div>

  <div class="invoice-title">
    <h1>INVOICE</h1>
    <div class="meta" id="meta"></div>
  </div>
</div>

<hr>

<!-- TO -->
<div class="to" id="to"></div>

<!-- ITEMS -->
<table>
  <thead>
    <tr>
      <th style="width:5%">NO</th>
      <th>ITEM DESCRIPTION</th>
      <th style="width:10%">QTY</th>
      <th style="width:15%">U/PRICE</th>
      <th style="width:15%">AMOUNT</th>
    </tr>
  </thead>
  <tbody id="items"></tbody>
</table>

<div class="total" id="total"></div>

<!-- TERMS -->
<div class="terms">
  <strong>TERMS :</strong><br>
  50% deposit upon confirmations and the balance 50% should be clear by project completions.
</div>

<!-- BANK -->
<div class="bank">
  <strong>ALL CHEQUES TO BE CROSSED AND MAKE PAYABLE TO THE ORDER OF</strong><br>
  MMAC CONSTRUCTION<br><br>
  <strong>COMPANY ACCOUNT NUMBER :</strong><br>
  MAYBANK : 5142-0863-6636
</div>

<p style="margin-top:20px;font-size:13px;">Thank You.</p>

<script>
const params = new URLSearchParams(location.search);
const id = params.get("id");

async function loadInvoice() {
  const res = await fetch(`/api/invoice-view?id=${id}`, {
    credentials: "include"
  });

  if (!res.ok) {
    location.href = "/login.html";
    return;
  }

  const data = await res.json();
  const inv = data.invoice;

  // Meta
  document.getElementById("meta").innerHTML = `
    Inv : INV-${inv.id}<br>
    Date : ${inv.created_at}<br>
    Page : 1 of 1
  `;

  // To
  document.getElementById("to").innerHTML = `
    <strong>To :</strong> ${inv.customer}
  `;

  let total = 0;
  const tbody = document.getElementById("items");
  tbody.innerHTML = "";

  data.items.forEach((it, idx) => {
    const amount = it.qty * it.price;
    total += amount;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="center">${idx + 1}</td>
      <td>${it.description}</td>
      <td class="center">${it.qty}</td>
      <td class="right">RM ${it.price.toFixed(2)}</td>
      <td class="right">RM ${amount.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("total").innerText =
    "RINGGIT MALAYSIA : TOTAL : RM " + total.toFixed(2);
}

loadInvoice();
</script>

</body>
</html>
