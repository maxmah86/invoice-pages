<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Invoice</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  margin: 0;
  padding: 10px;
  color: #000;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.company {
  font-size: 13px;
}

.company h2 {
  margin: 0 0 4px;
}

.invoice-title {
  text-align: right;
}

.invoice-title h1 {
  margin: 0;
}

.meta {
  font-size: 13px;
  margin-top: 4px;
}

.to {
  margin-top: 12px;
  font-size: 13px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  font-size: 14px;
}

th, td {
  border: 1px solid #000;
  padding: 8px;
}

th {
  background: #f0f0f0;
  text-align: center;
}

.right {
  text-align: right;
}

.total-row td {
  font-weight: bold;
}

.actions {
  margin: 12px 0;
  display: flex;
  gap: 8px;
}

.actions button {
  flex: 1;
  padding: 10px;
  font-size: 14px;
}

/* üì± ÊâãÊú∫‰ºòÂåñÔºà‰∏çÊîπÁªìÊûÑÔºâ */
@media (max-width: 768px) {
  body {
    padding: 8px;
  }

  table {
    font-size: 13px;
  }

  th, td {
    padding: 6px;
  }

  .company, .meta, .to {
    font-size: 12px;
  }
}

/* üñ®Ô∏è ÊâìÂç∞ */
@media print {
  .actions {
    display: none;
  }

  @page {
    size: A4;
    margin: 15mm;
  }
}
</style>
</head>

<body>

<div class="actions">
  <button onclick="history.back()">‚Üê Back</button>
  <button onclick="window.print()">Print / PDF</button>
</div>

<div class="header">
  <div class="company">
    <h2>MMAC CONSTRUCTION</h2>
    201903139488 (002972725-A)<br>
    52, Jalan Mahogani SD 1/3<br>
    Sri Damansara, 52200 Kuala Lumpur<br>
    Tel : 016-444-2128
  </div>

  <div class="invoice-title">
    <h1>INVOICE</h1>
    <div class="meta" id="meta"></div>
  </div>
</div>

<div class="to" id="to"></div>

<table>
  <thead>
    <tr>
      <th style="width:5%">NO</th>
      <th>ITEM DESCRIPTION</th>
      <th style="width:10%">QTY</th>
      <th style="width:15%">U/PRICE</th>
      <th style="width:15%">AMOUNT</th>
    </tr>
  </thead>
  <tbody id="items"></tbody>
  <tfoot>
    <tr class="total-row">
      <td colspan="4" class="right">TOTAL (RM)</td>
      <td class="right" id="total"></td>
    </tr>
  </tfoot>
</table>

<script>
const id = new URLSearchParams(location.search).get("id");

async function loadInvoice() {
  const res = await fetch(`/api/invoice-view?id=${id}`, {
    credentials: "include"
  });

  if (!res.ok) {
    location.href = "/login.html";
    return;
  }

  const data = await res.json();
  const inv = data.invoice;

  document.getElementById("meta").innerHTML = `
    Inv : ${inv.invoice_no}<br>
    Date : ${inv.created_at}<br>
    Status : ${inv.status}
  `;

  document.getElementById("to").innerHTML =
    "<strong>To :</strong><br>" + inv.customer;

  let total = 0;
  const tbody = document.getElementById("items");
  tbody.innerHTML = "";

  data.items.forEach((it, i) => {
    const amt = it.qty * it.price;
    total += amt;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${it.description}</td>
      <td class="right">${it.qty}</td>
      <td class="right">${it.price.toFixed(2)}</td>
      <td class="right">${amt.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("total").innerText = total.toFixed(2);
}

loadInvoice();
</script>

</body>
</html>
