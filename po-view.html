<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Purchase Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 16px;
  color: #000;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.company {
  font-size: 14px;
}

.company h1 {
  margin: 0 0 6px;
  font-size: 22px;
}

.po-title {
  text-align: right;
}

.po-title h2 {
  margin: 0 0 6px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
}

table, th, td {
  border: 1px solid #000;
}

th, td {
  padding: 8px;
  font-size: 14px;
}

th {
  background: #f2f2f2;
}

.total {
  text-align: right;
  font-size: 16px;
  font-weight: bold;
  margin-top: 10px;
}

.section {
  margin-top: 20px;
  font-size: 14px;
}

.label {
  font-weight: bold;
}

.print-btn {
  margin-top: 20px;
  text-align: center;
}

@media print {
  .print-btn {
    display: none;
  }
}
</style>
</head>

<body>

<div class="header">
  <div class="company">
    <h1>MMAC CONSTRUCTION</h1>
    <div>201903134488 (002977225-A)</div>
    <div>52, Jalan Mahogani SD 1/3</div>
    <div>Sri Damansara</div>
    <div>52200 Kuala Lumpur, Malaysia</div>
    <div>Tel: 016-444-2128</div>
  </div>

  <div class="po-title">
    <h2>PURCHASE ORDER</h2>
    <div><b>PO No:</b> <span id="poNo"></span></div>
    <div><b>Date:</b> <span id="poDate"></span></div>
    <div><b>Supplier:</b> <span id="supplier"></span></div>
    <div><b>Issued by:</b> <span id="issuedBy"></span></div>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>No</th>
      <th>Description</th>
      <th>Qty</th>
      <th>Unit Price</th>
      <th>Amount (RM)</th>
    </tr>
  </thead>
  <tbody id="items"></tbody>
</table>

<div class="total">
  TOTAL (RM): <span id="total"></span>
</div>

<div class="section">
  <div class="label">NOTES:</div>
  <div id="notes">-</div>
</div>

<div class="section">
  <div class="label">DELIVERY / COMPLETION:</div>
  <div>Address: <span id="deliveryAddress"></span></div>
  <div>Date: <span id="deliveryDate"></span></div>
  <div>Time: <span id="deliveryTime"></span></div>
</div>

<div class="section">
  <div class="label">Thank you.</div>
</div>

<div class="section">
  <div class="label">Signed by:</div>
  <div id="signedBy">________________________</div>
</div>

<div class="print-btn">
  <button onclick="window.print()">Print / Save PDF</button>
</div>

<script>
/* ===== Auth Check ===== */
fetch("/api/auth-check", { credentials: "include" })
  .then(r => r.json())
  .then(d => {
    if (!d.loggedIn) location.replace("/login.html");
  });

/* ===== Load PO ===== */
const params = new URLSearchParams(location.search);
const id = params.get("id");

async function loadPO() {
  const res = await fetch(`/api/po-get?id=${id}`);
  const po = await res.json();

  document.getElementById("poNo").innerText = po.po_no;
  document.getElementById("poDate").innerText = po.po_date;
  document.getElementById("supplier").innerText = po.supplier_name;
  document.getElementById("issuedBy").innerText = po.issued_by || "-";
  document.getElementById("notes").innerText = po.notes || "-";
  document.getElementById("deliveryAddress").innerText = po.delivery_address || "-";
  document.getElementById("deliveryDate").innerText = po.delivery_date || "-";
  document.getElementById("deliveryTime").innerText = po.delivery_time || "-";
  document.getElementById("signedBy").innerText = po.signed_by || "";

  document.getElementById("total").innerText = Number(po.total).toFixed(2);

  const tbody = document.getElementById("items");
  tbody.innerHTML = "";

  po.items.forEach((it, i) => {
    const qty = Number(it.qty);
    const price = Number(it.unit_price);
    const amount = qty * price;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${it.description}</td>
      <td>${qty}</td>
      <td>${price.toFixed(2)}</td>
      <td>${amount.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });
}

loadPO();
</script>

</body>
</html>
