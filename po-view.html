<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Purchase Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; margin:16px; color:#000; }
.header { display:flex; justify-content:space-between; }
h1 { margin:0; }
table { width:100%; border-collapse:collapse; margin-top:16px; }
th,td { border:1px solid #000; padding:6px; font-size:13px; }
th { background:#f0f0f0; }
.text-right { text-align:right; }
.total { font-weight:bold; font-size:16px; text-align:right; margin-top:10px; }
@media print { button { display:none; } }
</style>
</head>

<body>

<div class="header">
  <div>
    <h1>MMAC CONSTRUCTION</h1>
    201903134488 (002977225-A)<br>
    Tel: 016-444-2128
  </div>
  <div style="text-align:right">
    <h2>PURCHASE ORDER</h2>
    <div>PO No: <span id="poNo"></span></div>
    <div>Date: <span id="poDate"></span></div>
    <div>Supplier: <span id="supplier"></span></div>
    <div>Status: <span id="status"></span></div>
  </div>
</div>

<table>
<thead>
<tr>
  <th>No</th>
  <th>Description</th>
  <th>Qty</th>
  <th>Unit Price</th>
  <th>Amount</th>
</tr>
</thead>
<tbody id="items"></tbody>
</table>

<div class="total">
  TOTAL (RM): <span id="total"></span>
</div>

<div style="margin-top:20px">
  <b>Delivery:</b><br>
  <span id="delivery"></span>
</div>

<div style="margin-top:20px">
  <b>Notes:</b><br>
  <span id="notes"></span>
</div>

<button onclick="window.print()">PRINT / SAVE PDF</button>

<script>
const id = new URLSearchParams(location.search).get("id");

fetch(`/api/po-view?id=${id}`, { credentials:"include" })
.then(r=>r.json())
.then(data=>{
  const po = data.po;

  poNo.textContent = po.po_no;
  poDate.textContent = po.po_date;
  supplier.textContent = po.supplier;
  status.textContent = po.status;
  delivery.textContent =
    (po.delivery_address || "-") + " " +
    (po.delivery_date || "") + " " +
    (po.delivery_time || "");
  notes.textContent = po.notes || "-";

  let total = 0;
  const tbody = document.getElementById("items");

  data.items.forEach((it,i)=>{
    const amount = it.qty * it.price;
    total += amount;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${it.description}</td>
      <td class="text-right">${it.qty}</td>
      <td class="text-right">${it.price.toFixed(2)}</td>
      <td class="text-right">${amount.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("total").textContent = total.toFixed(2);
});
</script>

</body>
</html>
