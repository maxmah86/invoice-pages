<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Purchase Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- 保留你原本 invoice-view 的 CSS -->
<link rel="stylesheet" href="style.css">

</head>

<body>

<h2>Purchase Order</h2>

<!-- ===== PO INFO ===== -->
<div class="card">
  <div><strong>PO No:</strong> <span id="po_no"></span></div>
  <div><strong>PO Date:</strong> <span id="po_date"></span></div>
  <div><strong>Status:</strong> <span id="status"></span></div>
</div>

<!-- ===== SUPPLIER ===== -->
<div class="card">
  <div><strong>Supplier:</strong></div>
  <div id="supplier_name"></div>
  <div id="supplier_address"></div>
</div>

<!-- ===== ITEMS ===== -->
<div class="card">
  <table width="100%" border="1" cellspacing="0" cellpadding="6">
    <thead>
      <tr>
        <th>Description</th>
        <th width="60">Qty</th>
        <th width="90">Unit</th>
        <th width="90">Amount</th>
      </tr>
    </thead>
    <tbody id="items"></tbody>
  </table>
</div>

<!-- ===== TOTAL ===== -->
<div class="card" style="text-align:right;">
  <strong>Total: RM <span id="total"></span></strong>
</div>

<a href="pos.html">← Back</a>

<!-- ===== LOGIN REQUIRE ===== -->
<script>
fetch("/api/auth-check", { credentials: "include" })
  .then(r => r.json())
  .then(d => {
    if (!d.loggedIn) location.replace("/login.html");
  })
  .catch(() => location.replace("/login.html"));
</script>

<script>
const id = new URLSearchParams(location.search).get("id");
if (!id) {
  alert("Missing PO id");
  history.back();
}

fetch("/api/po-view?id=" + id)
  .then(r => r.json())
  .then(data => {

    po_no.textContent = data.po_no;
    po_date.textContent = data.po_date;
    status.textContent = data.status;

    supplier_name.textContent = data.supplier_name;
    supplier_address.textContent = data.supplier_address || "";

    total.textContent = Number(data.total).toFixed(2);

    const tbody = document.getElementById("items");
    tbody.innerHTML = "";

    data.items.forEach(i => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i.description}</td>
        <td>${i.qty}</td>
        <td>${Number(i.unit_price).toFixed(2)}</td>
        <td>${Number(i.line_total).toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });
  })
  .catch(() => alert("Failed to load PO"));
</script>

</body>
</html>
