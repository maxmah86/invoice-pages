<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>View Purchase Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 16px;
}

h1 {
  margin: 0;
}

.subtitle {
  font-size: 14px;
  color: #555;
  margin-bottom: 16px;
}

.card {
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 14px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

.row {
  font-size: 14px;
  margin-bottom: 6px;
}

.label {
  font-weight: bold;
}

.section-title {
  font-size: 15px;
  font-weight: bold;
  margin-bottom: 8px;
  border-bottom: 1px solid #ddd;
  padding-bottom: 4px;
}

.status {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
}

.status.OPEN {
  background: #f39c12;
  color: #000;
}
.status.SENT {
  background: #2980b9;
  color: #fff;
}
.status.DELIVERED {
  background: #27ae60;
  color: #fff;
}

.btn {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  margin-top: 8px;
}

.btn-primary {
  background: #2c3e50;
  color: #fff;
}

.btn-secondary {
  background: #7f8c8d;
  color: #fff;
}

.btn-success {
  background: #27ae60;
  color: #fff;
}
</style>
</head>

<body>

<h1>Purchase Order</h1>
<div class="subtitle">MMAC Construction</div>

<div id="content"></div>

<script>
/* ===== LOGIN CHECK ===== */
fetch("/api/auth-check", { credentials: "include" })
  .then(r => r.json())
  .then(d => {
    if (!d.loggedIn) location.replace("/login.html");
  })
  .catch(() => location.replace("/login.html"));

/* ===== GET ID ===== */
const params = new URLSearchParams(location.search);
const id = params.get("id");

if (!id) {
  alert("Missing PO ID");
  history.back();
}

/* ===== LOAD PO ===== */
async function loadPO() {
  const res = await fetch(`/api/po-view?id=${id}`, {
    credentials: "include"
  });
  const data = await res.json();

  if (!data.po) {
    alert("PO not found");
    history.back();
    return;
  }

  const po = data.po;
  const el = document.getElementById("content");

  el.innerHTML = `
    <!-- BASIC INFO -->
    <div class="card">
      <div class="row"><span class="label">PO No:</span> ${po.po_no}</div>
      <div class="row"><span class="label">PO Date:</span> ${po.po_date}</div>
      <div class="row"><span class="label">Supplier:</span> ${po.supplier_name}</div>
      <div class="row"><span class="label">Issued By:</span> ${po.issued_by || "-"}</div>
      <div class="row">
        <span class="status ${po.status}">${po.status}</span>
      </div>
    </div>

    <!-- DELIVERY -->
    <div class="card">
      <div class="section-title">Delivery / Completion</div>
      <div class="row"><span class="label">Address:</span> ${po.delivery_address || "-"}</div>
      <div class="row"><span class="label">Date:</span> ${po.delivery_date || "-"}</div>
      <div class="row"><span class="label">Time:</span> ${po.delivery_time || "-"}</div>
    </div>

    <!-- NOTES -->
    <div class="card">
      <div class="section-title">Notes</div>
      <div class="row">${po.notes || "-"}</div>
    </div>

    <!-- TOTAL -->
    <div class="card">
      <div class="section-title">Amount</div>
      <div class="row">
        <span class="label">Subtotal:</span>
        RM ${Number(po.subtotal || 0).toFixed(2)}
      </div>
      <div class="row">
        <span class="label">Total:</span>
        RM ${Number(po.total || 0).toFixed(2)}
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="card">
      <button class="btn btn-primary" onclick="history.back()">Back</button>
      <button class="btn btn-secondary" onclick="printPO()">Print / PDF</button>
    </div>
  `;
}

loadPO();

/* ===== PRINT ===== */
function printPO() {
  window.print();
}
</script>

</body>
</html>
