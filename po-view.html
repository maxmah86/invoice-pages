<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Purchase Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  color: #000;
  padding: 24px;
  background: #fff;
}

.header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}

.company {
  width: 55%;
}

.company h2 {
  margin: 0;
}

.po-info {
  width: 40%;
  text-align: right;
}

.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.table th, .table td {
  border: 1px solid #000;
  padding: 6px;
  font-size: 14px;
}

.table th {
  background: #f2f2f2;
}

.total {
  text-align: right;
  margin-top: 10px;
  font-weight: bold;
}

.section {
  margin-top: 20px;
  font-size: 14px;
}

.signature {
  margin-top: 40px;
}
</style>
</head>

<body>

<div class="header">
  <div class="company">
    <h2>MMAC CONSTRUCTION</h2>
    <div>201903134488 (002977225-A)</div>
    <div>52, Jalan Mahogani SD 1/3</div>
    <div>Sri Damansara</div>
    <div>52200 Kuala Lumpur, Malaysia</div>
    <div>Tel: 016-444-2128</div>
  </div>

  <div class="po-info">
    <h2>PURCHASE ORDER</h2>
    <div><strong>PO No:</strong> <span id="po_no"></span></div>
    <div><strong>Date:</strong> <span id="po_date"></span></div>
    <div><strong>Supplier:</strong> <span id="supplier_name"></span></div>
  </div>
</div>

<table class="table">
  <thead>
    <tr>
      <th>No</th>
      <th>Description</th>
      <th>Qty</th>
      <th>Unit Price</th>
      <th>Amount (RM)</th>
    </tr>
  </thead>
  <tbody id="items"></tbody>
</table>

<div class="total">
  TOTAL (RM): <span id="total"></span>
</div>

<div class="section">
  <strong>NOTES:</strong>
  <div id="notes"></div>
</div>

<div class="section">
  <strong>DELIVERY / COMPLETION:</strong>
  <div>Address: <span id="delivery_address"></span></div>
  <div>Date: <span id="delivery_date"></span></div>
  <div>Time: <span id="delivery_time"></span></div>
</div>

<div class="section">
  Thank you.
</div>

<div class="signature">
  <strong>Signed by:</strong> <span id="signed_by"></span><br>
  <span id="signed_at"></span>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");

fetch(`/api/po-view?id=${id}`, { credentials: "include" })
  .then(r => r.json())
  .then(po => {
    document.getElementById("po_no").textContent = po.po_no;
    document.getElementById("po_date").textContent = po.po_date;
    document.getElementById("supplier_name").textContent = po.supplier_name;
    document.getElementById("total").textContent = Number(po.total).toFixed(2);
    document.getElementById("notes").textContent = po.notes || "";
    document.getElementById("delivery_address").textContent = po.delivery_address || "";
    document.getElementById("delivery_date").textContent = po.delivery_date || "";
    document.getElementById("delivery_time").textContent = po.delivery_time || "";
    document.getElementById("signed_by").textContent = po.signed_by || "";
    document.getElementById("signed_at").textContent = po.signed_at || "";

    const tbody = document.getElementById("items");
    po.items.forEach((it, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${it.description}</td>
        <td>${it.qty}</td>
        <td>${Number(it.unit_price).toFixed(2)}</td>
        <td>${Number(it.amount).toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });
  });
</script>

</body>
</html>
