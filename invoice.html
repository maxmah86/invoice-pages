<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Create Invoice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
<h2>Create Invoice</h2>

<input id="customer" placeholder="Customer name"><br><br>

<table border="1" cellpadding="6">
<thead>
<tr><th>Item</th><th>Qty</th><th>Price</th></tr>
</thead>
<tbody id="items"></tbody>
</table>

<button onclick="add()">Add Item</button><br><br>
<button onclick="submit()">Submit Invoice</button>

<script>
function add(){
  items.insertAdjacentHTML("beforeend",`
    <tr>
      <td><input></td>
      <td><input type="number" value="1"></td>
      <td><input type="number" value="0"></td>
    </tr>
  `);
}
add();

async function submit(){
  const rows=[...items.rows].map(r=>({
    description:r.cells[0].firstChild.value,
    qty:+r.cells[1].firstChild.value,
    price:+r.cells[2].firstChild.value
  }));

  const res = await fetch("/api/invoice",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ customer:customer.value, items:rows })
  });

  if(res.ok){
    location.href="/invoices.html";
  }else{
    alert("Submit failed");
  }
}
</script>
</body>
</html>
