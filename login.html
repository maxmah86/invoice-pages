<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 16px;
}

h2 {
  text-align: center;
}

.box {
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  max-width: 360px;
  margin: 80px auto;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

label {
  display: block;
  margin-top: 12px;
  font-size: 14px;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 6px;
  box-sizing: border-box;
}

button {
  width: 100%;
  margin-top: 18px;
  padding: 12px;
  font-size: 16px;
  background: #2c3e50;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.error {
  margin-top: 12px;
  color: #c0392b;
  font-size: 14px;
  text-align: center;
}
</style>
</head>

<body>

<div class="box">
  <h2>MMAC Login</h2>

  <label>Username</label>
  <input id="username" autocomplete="username">

  <label>Password</label>
  <input id="password" type="password" autocomplete="current-password">

  <button onclick="login()">Login</button>

  <div class="error" id="error"></div>
</div>

<script>
async function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const errorBox = document.getElementById("error");

  errorBox.textContent = "";

  if (!username || !password) {
    errorBox.textContent = "Username and password required";
    return;
  }

  const res = await fetch("/api/login", {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  });

  if (!res.ok) {
    const e = await res.json().catch(() => ({}));
    errorBox.textContent = e.error || "Login failed";
    return;
  }

  // ðŸ”‘ ç™»å½•æˆåŠŸåŽ â†’ å†æŸ¥ä¸€æ¬¡ auth-check æ‹¿ role
  const auth = await fetch("/api/auth-check", {
    credentials: "include"
  }).then(r => r.json());

  if (!auth.loggedIn) {
    errorBox.textContent = "Session error, please login again";
    return;
  }

  // âœ… æŒ‰è§’è‰²è·³è½¬
  if (auth.role === "admin") {
    location.replace("/index.html");
  } else {
    location.replace("/work-checklist.html");
  }
}
</script>

</body>
</html>
