<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PO Summary</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 16px;
  color: #000;
}

h1 {
  margin: 0 0 4px;
}

.subtitle {
  color: #555;
  margin-bottom: 16px;
}

.card {
  background: #fff;
  border-radius: 8px;
  padding: 14px;
  margin-bottom: 12px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

.supplier {
  font-weight: bold;
  font-size: 16px;
}

.meta {
  font-size: 13px;
  color: #555;
  margin-top: 6px;
}

.amount {
  margin-top: 8px;
  font-weight: bold;
}

.badges {
  margin-top: 6px;
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.badge {
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 12px;
  color: #fff;
}

.OPEN { background: #2980b9; }
.APPROVED { background: #27ae60; }
.CLOSED { background: #7f8c8d; }
</style>
</head>

<body>

<h1>PO Summary</h1>
<div class="subtitle">Purchase Orders by Supplier</div>

<div id="list"></div>

<div id="empty" class="subtitle" style="display:none;text-align:center;">
  No purchase orders found.
</div>

<!-- LOGIN REQUIRE -->
<script>
fetch("/api/auth-check", { credentials: "include" })
  .then(r => r.json())
  .then(d => {
    if (!d.loggedIn) location.replace("/login.html");
  })
  .catch(() => location.replace("/login.html"));
</script>

<script>
async function loadSummary() {
  const r = await fetch("/api/po-summary", { credentials: "include" });
  if (!r.ok) {
    alert("Failed to load PO summary");
    return;
  }

  const data = await r.json();
  const list = document.getElementById("list");
  const empty = document.getElementById("empty");

  list.innerHTML = "";

  if (!data.length) {
    empty.style.display = "block";
    return;
  }

  empty.style.display = "none";

  data.forEach(row => {
    const c = document.createElement("div");
    c.className = "card";
    c.innerHTML = `
      <div class="supplier">${row.supplier_name}</div>

      <div class="meta">
        Total POs: ${row.total_po}
      </div>

      <div class="badges">
        <span class="badge OPEN">OPEN: ${row.open_count}</span>
        <span class="badge APPROVED">APPROVED: ${row.approved_count}</span>
        ${row.closed_count
          ? `<span class="badge CLOSED">CLOSED: ${row.closed_count}</span>`
          : ``}
      </div>

      <div class="amount">
        Total Amount: RM ${Number(row.total_amount).toFixed(2)}
      </div>
    `;
    list.appendChild(c);
  });
}

loadSummary();
</script>

</body>
</html>
